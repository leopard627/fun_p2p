# Kademlia DHT 기반 P2P 네트워크 구현

간단한 Kademlia 분산 해시 테이블(DHT)을 사용하여 P2P 네트워크를 구현한 프로젝트입니다. 이 프로젝트는 분산 시스템의 기본 개념을 이해하고 실험하기 위한 목적으로 개발되었습니다.

## 프로젝트 개요

이 프로젝트는 Python의 `kademlia` 라이브러리를 사용하여 다음과 같은 기능을 구현합니다:

- 부트스트랩 노드 설정 및 관리
- 분산 해시 테이블(DHT)에 데이터 저장 및 검색
- 피어 탐색 및 직접 P2P 연결
- 간단한 메시지 교환

## 시스템 구성

프로젝트는 두 가지 주요 컴포넌트로 구성됩니다:

1. **부트스트랩 노드** (`bootstrap_node.py`)
   - 네트워크 진입점 역할
   - DHT 데이터 지속적 저장
   - 피어 디스커버리 지원

2. **피어 노드** (`peer.py`)
   - DHT를 통한 다른 피어 탐색
   - 토픽 기반 그룹 참여
   - 직접 P2P 통신

## 기술 스택

- **Python 3.9+**
- **aiokademlia**: Kademlia DHT 프로토콜 구현
- **asyncio**: 비동기 I/O 작업 처리
- **JSON**: 데이터 직렬화

## 설치 방법

1. 필요한 환경 설정 (Python 3.9+ 및 pipenv 필요)

```bash
# pyenv로 가상환경 생성 (선택사항)
pyenv virtualenv 3.12.1 fun_p2p
pyenv local fun_p2p

# 의존성 설치
pip install -r requirements/requirements.txt
```

## 실행 방법

### 1. 부트스트랩 노드 실행

```bash
python bootstrap_node.py
```

부트스트랩 노드는 기본적으로 `0.0.0.0:8468`에서 수신 대기합니다.

### 2. 피어 노드 실행

```bash
python peer.py
```

각 피어 노드는 랜덤 포트를 사용하여 시작하고 부트스트랩 노드에 자동으로 연결됩니다.

## 작동 원리

1. **노드 부트스트래핑**:
   - 피어 노드는 시작 시 알려진 부트스트랩 노드에 연결합니다.
   - Kademlia 프로토콜을 통해 네트워크 토폴로지를 학습합니다.

2. **피어 디스커버리**:
   - 각 피어는 자신의 ID와 주소 정보를 DHT에 저장합니다.
   - 토픽 키워드(예: "global-chat")를 사용하여 관심 그룹을 형성합니다.

3. **직접 연결**:
   - DHT에서 발견한 피어 정보를 사용해 직접적인 TCP 연결을 설정합니다.
   - 간단한 메시지를 교환하여 연결을 확인합니다.

## 시스템 구조

```
┌─────────────────┐         ┌─────────────────┐
│  Bootstrap Node │◀────────▶│    Peer Node    │
└─────────────────┘         └─────────────────┘
        ▲                          ▲  ▲
        │                          │  │
        │                          │  │
        ▼                          │  │
┌─────────────────┐                │  │
│  Kademlia DHT   │◀───────────────┘  │
└─────────────────┘                   │
        ▲                             │
        │                             │
        ▼                             ▼
┌─────────────────┐         ┌─────────────────┐
│    Peer Node    │◀────────▶│    Peer Node    │
└─────────────────┘         └─────────────────┘
```

## 주요 기능

- **분산 데이터 저장**: 키-값 형태로 데이터를 네트워크 전체에 분산 저장
- **자동 피어 탐색**: 네트워크 참여자를 자동으로 찾고 연결
- **토픽 기반 그룹**: 공통 관심사를 중심으로 피어 그룹화
- **직접 P2P 메시징**: 중앙 서버 없이 피어 간 직접 통신

## 개발 노트

### 알려진 제한사항

- **NAT 투과**: 현재 구현은 NAT 뒤에 있는 노드 간 직접 연결을 지원하지 않음
- **데이터 타입 제한**: DHT는 기본적으로 원시 타입만 저장 가능 (JSON 직렬화로 해결)
- **보안**: 현재 구현은 암호화나 인증 메커니즘을 포함하지 않음

### 향후 개선 방향

- **NAT 투과 기능**: STUN/TURN을 활용한 NAT 투과 구현
- **데이터 암호화**: 피어 간 통신 암호화 추가
- **분산 콘텐츠 저장**: 대용량 콘텐츠의 분산 저장 및 검색 구현
- **피어 신뢰 메커니즘**: 신뢰할 수 있는 피어 식별 메커니즘 도입

## 라이선스

MIT

## 기여하기

버그 신고나 기능 제안은 이슈 트래커를 통해 제출해 주세요. 풀 리퀘스트도 환영합니다.
